# -*- coding: utf-8 -*-
"""Weather.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1TjOWlpvRwMHqrF1F5JKFZAxsD8TAdktb
"""

from google.colab import files
uploaded = files.upload()

import pandas as pd
df = pd.read_csv("Bakkhali_7_years_weather_data.csv")
df.head()

import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.multioutput import MultiOutputRegressor
from sklearn.metrics import mean_squared_error, r2_score
from xgboost import XGBRegressor

df["Datetime"] = pd.to_datetime(df["Datetime"])

df = df.sort_values("Datetime").reset_index(drop=True)

df["hour"] = df["Datetime"].dt.hour
df["dayofweek"] = df["Datetime"].dt.dayofweek
df["month"] = df["Datetime"].dt.month
df["dayofyear"] = df["Datetime"].dt.dayofyear

df["hour_sin"] = np.sin(2 * np.pi * df["hour"] / 24)
df["hour_cos"] = np.cos(2 * np.pi * df["hour"] / 24)

df["month_sin"] = np.sin(2 * np.pi * df["month"] / 12)
df["month_cos"] = np.cos(2 * np.pi * df["month"] / 12)

feature_cols = [
    "hour_sin", "hour_cos",
    "month_sin", "month_cos",
    "dayofweek", "dayofyear"
]

target_cols = [
    "Temperature(Â°C)",
    "Radiation(W/m^2)",
    "Cloud_Coverage(%)",
    "Rain_(mm/hour)",
    "Relative_Humidity(%)"
]

df = df.dropna().reset_index(drop=True)

X = df[feature_cols]
Y = df[target_cols]

train_size = int(len(df) * 0.8)

X_train = X.iloc[:train_size]
X_test  = X.iloc[train_size:]

Y_train = Y.iloc[:train_size]
Y_test  = Y.iloc[train_size:]

base_model = XGBRegressor(
    n_estimators=300,
    learning_rate=0.05,
    max_depth=6,
    subsample=0.8,
    colsample_bytree=0.8,
    random_state=42
)

model = MultiOutputRegressor(base_model)

model.fit(X_train, Y_train)

predictions = model.predict(X_test)

rmse = np.sqrt(mean_squared_error(Y_test, predictions))
r2 = r2_score(Y_test, predictions)

print("Overall RMSE:", rmse)
print("Overall R2 Score:", r2)

future_datetime = pd.DataFrame({
    "Datetime": ["2026-03-20 14:00:00"]
})

future_datetime["Datetime"] = pd.to_datetime(future_datetime["Datetime"])

future_datetime["hour"] = future_datetime["Datetime"].dt.hour
future_datetime["dayofweek"] = future_datetime["Datetime"].dt.dayofweek
future_datetime["month"] = future_datetime["Datetime"].dt.month
future_datetime["dayofyear"] = future_datetime["Datetime"].dt.dayofyear

future_datetime["hour_sin"] = np.sin(2 * np.pi * future_datetime["hour"] / 24)
future_datetime["hour_cos"] = np.cos(2 * np.pi * future_datetime["hour"] / 24)

future_datetime["month_sin"] = np.sin(2 * np.pi * future_datetime["month"] / 12)
future_datetime["month_cos"] = np.cos(2 * np.pi * future_datetime["month"] / 12)

future_X = future_datetime[feature_cols]

future_prediction = model.predict(future_X)

print("\nPrediction for future datetime:")
print("Temperature:", future_prediction[0][0])
print("Radiation:", future_prediction[0][1])
print("Cloud:", future_prediction[0][2])
print("Rain:", future_prediction[0][3])
print("Humidity:", future_prediction[0][4])



wind_target = df["Wind Speed (m/s)"]

Y_train_wind = wind_target.iloc[:train_size]
Y_test_wind  = wind_target.iloc[train_size:]

wind_model = XGBRegressor(
    n_estimators=300,
    learning_rate=0.05,
    max_depth=6,
    subsample=0.8,
    colsample_bytree=0.8,
    random_state=42
)

wind_model.fit(X_train, Y_train_wind)

wind_predictions = wind_model.predict(X_test)

wind_rmse = np.sqrt(mean_squared_error(Y_test_wind, wind_predictions))
wind_r2 = r2_score(Y_test_wind, wind_predictions)

print("Wind RMSE:", wind_rmse)
print("Wind R2:", wind_r2)

future_wind_prediction = wind_model.predict(future_X)

print("Wind Speed:", future_wind_prediction[0])



